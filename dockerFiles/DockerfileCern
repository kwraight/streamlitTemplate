# base image
FROM python:3.8

# exposing default port for streamlit
EXPOSE 8501

# copy over and install packages
COPY requirements.txt ./requirements.txt
RUN pip3 install -r requirements.txt

# copying everything over
COPY *.py ./code/
COPY core/*.py ./code/core/
COPY corePages/*.py ./code/corePages/
COPY userPages/*.py ./code/userPages/

# fudge for CERN image
RUN mkdir /.streamlit
COPY temp_id  /.streamlit/.stable_random_id
RUN chmod 777 /.streamlit/.stable_random_id
RUN chmod -R 777 /code/

# run as not root
RUN adduser appuser
USER appuser

WORKDIR code

# match exposed port
CMD ["streamlit", "run", "mainApp.py","--server.port=8501"]
